# Deploy to DigitalOcean App Platform

## Prerequisites

1. DigitalOcean account
2. GitHub repository with the code
3. `doctl` CLI tool installed (optional)

## Deployment Steps

### 1. Create App from GitHub Repository

1. Go to [DigitalOcean Apps](https://cloud.digitalocean.com/apps)
2. Click "Create App"
3. Choose "GitHub" as source
4. Select your repository: `hebbarp/zipin`
5. Choose branch: `main`
6. DigitalOcean will detect the `.do/app.yaml` file automatically

### 2. Set Environment Variables

In the DigitalOcean App Platform dashboard, set these environment variables:

**Required secrets:**
- `SECRET_KEY_BASE`: `B6/xWTdMqZTW5PvaHm+j7AILOc5288QMhJ804sHYIEWTd1HqV7/udDgLlT+1353v`
- `PHX_HOST`: Your app's domain (will be provided after deployment)
- `DATABASE_URL`: Will be automatically set when database is created

### 3. Database Configuration

The managed PostgreSQL database will be created automatically as specified in `.do/app.yaml`:
- Engine: PostgreSQL 15
- Size: Development tier
- Region: Bangalore (blr1)

### 4. Deploy

1. Click "Create Resources"
2. Wait for deployment to complete
3. The app will automatically run migrations on startup

## Manual Deployment via CLI

If you prefer using `doctl`:

```bash
# Install doctl if not already installed
# Create app from spec
doctl apps create --spec .do/app.yaml

# Set environment variables
doctl apps update <app-id> --spec .do/app.yaml

# View logs
doctl apps logs <app-id>
```

## Post-Deployment

1. Update `PHX_HOST` environment variable with your actual domain
2. Test the authentication system:
   - Registration: `https://your-app.ondigitalocean.app/auth/register`
   - Login: `https://your-app.ondigitalocean.app/auth/login`

## Database Access

To access the database directly:

```bash
# Get connection info
doctl databases connection <database-id>

# Connect via psql
psql "postgresql://username:password@host:port/database?sslmode=require"
```

## Troubleshooting

1. **Migration Issues**: Check the app logs during startup
2. **Database Connection**: Ensure DATABASE_URL is properly set
3. **Build Issues**: Check the build logs in the DigitalOcean console

## Environment Variables Reference

| Variable | Description | Example |
|----------|-------------|---------|
| `SECRET_KEY_BASE` | Phoenix secret key | Generated 64-char string |
| `DATABASE_URL` | PostgreSQL connection string | Auto-generated by DO |
| `PHX_HOST` | Application hostname | `your-app.ondigitalocean.app` |
| `MIX_ENV` | Elixir environment | `prod` |
| `PHX_SERVER` | Start Phoenix server | `true` |
| `PORT` | HTTP port | `4000` |